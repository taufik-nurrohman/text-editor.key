/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((t="undefined"!=typeof globalThis?globalThis:t||self).TextEditor=t.TextEditor||{},t.TextEditor.Key=n())}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},e=function(t,n){return void 0===n&&(n=!0),!(!t||"object"!=typeof t)&&(!n||function(t,n){return!(!t||"object"!=typeof t)&&o(n)&&o(t.constructor)&&n===t.constructor}(t,Object))},o=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},r=function(t){return"string"==typeof t};function u(t){var n=this;return n.commands={},n.key=null,n.keys={},n.self=t||n,n.set=new Set,n}var i=u.prototype;i.command=function(t){var n=this;if(r(t))return t===n.toString();var e=n.keys[n.toString()];return!!o(e)&&e},i.fire=function(e,u){var i,f,s=this,a=s.self||s;return u=u||[],n(e)||r(e)&&(e=s.commands[e])?(i=e.apply(a,u),f=!0):t(e)&&(t(e[1])&&e[1].forEach((function(t,n){return o(t)&&(u[n]=t)})),(e=s.commands[e[0]])&&(i=e.apply(a,u),f=!0)),f?!o(i)||i:null},i.pull=function(t){var n=this;return n.key=null,o(t)?(n.set.delete(t),n):(n.set=new Set,n)},i.push=function(t){var n=this;return n.set.add(n.key=t,1),n},i.toArray=function(){return Array.from(this.set)},i.toString=function(){return this.toArray().join("-")},Object.defineProperty(u,"name",{value:"Key"});var f,s,a,c=function(t){return t.length},l=function(){for(var n=arguments.length,r=Array(n),u=0;u<n;u++)r[u]=arguments[u];for(var i,f=r.shift(),s=0,a=c(r);s<a;++s)for(var p in r[s])if(o(f[p]))if(t(f[p])&&t(r[s][p])){f[p]=[].concat(f[p]);for(var y=0,h=c(r[s][p]);y<h;++y)i=r[s][p][y],-1===f[p].indexOf(i)&&f[p].push(r[s][p][y])}else e(f[p])&&e(r[s][p])?f[p]=l({},f[p],r[s][p]):f[p]=r[s][p];else f[p]=r[s][p];return f},p=(f=function(t,n){t.pull(),n.altKey&&t.push("Alt"),n.ctrlKey&&t.push("Control"),n.metaKey&&t.push("Meta"),n.shiftKey&&t.push("Shift")},s=1e3,function(){var t=arguments,n=this;a&&clearTimeout(a),a=setTimeout((function(){return f.apply(n,t)}),s)}),y=new WeakMap;function h(t){return y.get(t)||null}function d(t){h(this).pull()}function m(t){d.call(this,t)}function v(t){var n,e,o=t.key,r=h(this);r[t.altKey?"push":"pull"]("Alt"),r[t.ctrlKey?"push":"pull"]("Control"),r[t.metaKey?"push":"pull"]("Meta"),r[t.shiftKey?"push":"pull"]("Shift"),o&&r.push(o),(n=r.command())&&(!1===(e=r.fire(n))?(function(t){t&&t.preventDefault()}(t),function(t){t&&t.stopPropagation()}(t)):null===e&&console.warn("Unknown command:",n)),p(r,t)}function k(t){var n=t.key,e=h(this);n&&e.pull(n)}function K(t){var n=t.data,e=h(this);r(n)&&1===c(n)&&e.push(n)}function g(t){var n=t.data,e=h(this);r(n)&&1===c(n)&&e.pull(n)}var w={attach:function(){var t,e,o=this,r=o.constructor._,i=new u(o);return o.commands=l(o.commands=i.commands,o.state.commands||{}),o.keys=l(o.keys=i.keys,o.state.keys||{}),!n(r.command)&&(r.command=function(t,n){return this.commands[t]=n,this}),!n(r.k)&&(r.k=function(t){var n=h(this).toArray();return!1===t?n:n.join(t||"-")}),!n(r.key)&&(r.key=function(t,n){return this.keys[t]=n,this}),o.on("blur",d),o.on("focus",m),o.on("key.down",v),o.on("key.up",k),o.on("put.down",K),o.on("put.up",g),t=o,e=i,y.set(t,e),o},detach:function(){var t,n=this;return h(n).pull(),n.off("blur",d),n.off("focus",m),n.off("key.down",v),n.off("key.up",k),n.off("put.down",K),n.off("put.up",g),t=n,y.delete(t),n},name:"TextEditor.Key"};return w}));