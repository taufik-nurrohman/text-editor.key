/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((t="undefined"!=typeof globalThis?globalThis:t||self).TextEditor=t.TextEditor||{},t.TextEditor.Key=n())}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},n=function(t){return"function"==typeof t},e=function(t,n){return void 0===n&&(n=!0),!(!t||"object"!=typeof t)&&(!n||function(t,n){return!(!t||"object"!=typeof t)&&r(n)&&r(t.constructor)&&n===t.constructor}(t,Object))},r=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t};function u(t){var n=this;return n.commands={},n.key=null,n.keys={},n.self=t||n,n.set=new Set,n}var i=u.prototype;i.command=function(t){var n=this;if(o(t))return t===n.toString();var e=n.keys[n.toString()];return!!r(e)&&e},i.fire=function(e,u){var i,f,a=this,s=a.self||a;return u=u||[],n(e)||o(e)&&(e=a.commands[e])?(i=e.apply(s,u),f=!0):t(e)&&(t(e[1])&&e[1].forEach((function(t,n){return r(t)&&(u[n]=t)})),(e=a.commands[e[0]])&&(i=e.apply(s,u),f=!0)),f?!r(i)||i:null},i.pull=function(t){var n=this;return n.key=null,r(t)?(n.set.delete(t),n):(n.set=new Set,n)},i.push=function(t){var n=this;return n.set.add(n.key=t,1),n},i.toArray=function(){return Array.from(this.set)},i.toString=function(){return this.toArray().join("-")},Object.defineProperty(u,"name",{value:"Key"});var f,a,s,c=function(t){return t.length},l=function(){for(var n=arguments.length,o=Array(n),u=0;u<n;u++)o[u]=arguments[u];for(var i,f=o.shift(),a=0,s=c(o);a<s;++a)for(var p in o[a])if(r(f[p]))if(t(f[p])&&t(o[a][p])){f[p]=[].concat(f[p]);for(var y=0,h=c(o[a][p]);y<h;++y)i=o[a][p][y],-1===f[p].indexOf(i)&&f[p].push(o[a][p][y])}else e(f[p])&&e(o[a][p])?f[p]=l({},f[p],o[a][p]):f[p]=o[a][p];else f[p]=o[a][p];return f},p=function(t){return t&&t.preventDefault()},y=function(t){return t&&t.stopPropagation()},h=(f=function(t,n){t.pull(),n.altKey&&t.push("Alt"),n.ctrlKey&&t.push("Control"),n.metaKey&&t.push("Meta"),n.shiftKey&&t.push("Shift")},a=1e3,function(){var t=arguments,n=this;s&&clearTimeout(s),s=setTimeout((function(){return f.apply(n,t)}),a)}),d=new WeakMap;function m(t){return d.get(t)||null}function v(t){m(this).pull()}function k(t){var n,e,r=t.key,o=m(this);o[t.altKey?"push":"pull"]("Alt"),o[t.ctrlKey?"push":"pull"]("Control"),o[t.metaKey?"push":"pull"]("Meta"),o[t.shiftKey?"push":"pull"]("Shift"),r&&o.push(r),(n=o.command())&&(!1===(e=o.fire(n))?(p(t),y(t)):null===e&&console.warn("Unknown command:",n)),h(o,t)}function w(t){var n=t.key,e=m(this);n&&e.pull(n)}function K(t){var n,e,r=t.data,u=m(this);o(r)&&1===c(r)&&u.push(r),(n=u.command())&&(!1===(e=u.fire(n))?(p(t),y(t)):null===e&&console.warn("Unknown command:",n)),h(u,t)}function g(t){var n=t.data,e=m(this);n&&e.pull(n)}var b={attach:function(){var t,e,r=this,o=r.constructor._,i=new u(r);return r.commands=l(r.commands=i.commands,r.state.commands||{}),r.keys=l(r.keys=i.keys,r.state.keys||{}),!n(o.command)&&(o.command=function(t,n){return this.commands[t]=n,this}),!n(o.k)&&(o.k=function(t){var n=m(this).toArray();return!1===t?n:n.join(t||"-")}),!n(o.key)&&(o.key=function(t,n){return this.keys[t]=n,this}),r.on("blur",v),r.on("key.down",k),r.on("key.up",w),r.on("put.down",K),r.on("put.up",g),t=r,e=i,d.set(t,e),r},detach:function(){var t,n=this;return m(n).pull(),n.off("blur",v),n.off("key.down",k),n.off("key.up",w),n.off("put.down",K),n.off("put.up",g),t=n,d.delete(t),n},name:"TextEditor.Key"};return b}));