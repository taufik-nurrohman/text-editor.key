/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t="undefined"!=typeof globalThis?globalThis:t||self).TextEditor=t.TextEditor||{},t.TextEditor.Key=e())}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return void 0===e&&(e=!0),!(!t||"object"!=typeof t)&&(!e||function(t,e){return!(!t||"object"!=typeof t)&&r(e)&&r(t.constructor)&&e===t.constructor}(t,Object))},r=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t};function u(t){var e=this;return e.commands={},e.key=null,e.keys={},e.self=t||e,e.set=new Set,e}var l=u.prototype;l.command=function(t){var e=this;if(o(t))return t===e.toString();var n=e.keys[e.toString()];return!!r(n)&&n},l.fire=function(n,u){var l,i,a=this,s=a.self||a;return u=u||[],e(n)||o(n)&&(n=a.commands[n])?(l=n.apply(s,u),i=!0):t(n)&&(t(n[1])&&n[1].forEach((function(t,e){return r(t)&&(u[e]=t)})),(n=a.commands[n[0]])&&(l=n.apply(s,u),i=!0)),i?!r(l)||l:null},l.pull=function(t){var e=this;return e.key=null,r(t)?(e.set.delete(t),e):(e.set=new Set,e)},l.push=function(t){var e=this;return e.set.add(e.key=t,1),e},l.toArray=function(){return Array.from(this.set)},l.toString=function(){return this.toArray().join("-")},Object.defineProperty(u,"name",{value:"Key"});var i,a,s,p=function(t){return t.length},f=function(){for(var e=arguments.length,o=Array(e),u=0;u<e;u++)o[u]=arguments[u];for(var l,i=o.shift(),a=0,s=p(o);a<s;++a)for(var c in o[a])if(r(i[c]))if(t(i[c])&&t(o[a][c])){i[c]=[].concat(i[c]);for(var d=0,y=p(o[a][c]);d<y;++d)l=o[a][c][d],-1===i[c].indexOf(l)&&i[c].push(o[a][c][d])}else n(i[c])&&n(o[a][c])?i[c]=f({},i[c],o[a][c]):i[c]=o[a][c];else i[c]=o[a][c];return i},c=(i=function(t,e){t.pull(),e.altKey&&t.push("Alt"),e.ctrlKey&&t.push("Control"),e.metaKey&&t.push("Meta"),e.shiftKey&&t.push("Shift")},a=1e3,function(){var t=arguments,e=this;s&&clearTimeout(s),s=setTimeout((function(){return i.apply(e,t)}),a)}),d=new WeakMap;function y(t){return d.get(t)||null}function h(t){y(this).pull()}function m(t){h.call(this,t)}function k(t){var e,n,r=y(this),o=t.data,u=t.inputType,l=t.key;"keydown"===t.type?(r[t.altKey?"push":"pull"]("Alt"),r[t.ctrlKey?"push":"pull"]("Control"),r[t.metaKey?"push":"pull"]("Meta"),r[t.shiftKey?"push":"pull"]("Shift"),l&&r.push(l)):"deleteContentBackward"===u?r.pull().push("Backspace"):"deleteContentForward"===u?r.pull().push("Delete"):"deleteWordBackward"===u?r.pull().push("Control").push("Backspace"):"deleteWordForward"===u?r.pull().push("Control").push("Delete"):"insertLineBreak"===u?r.pull().push("Enter"):"insertText"===u&&o&&(r.toArray().forEach((function(t){return 1===p(t)&&r.pull(t)})),r.push(o)),(e=r.command())&&(!1===(n=r.fire(e))?(function(t){t&&t.preventDefault()}(t),function(t){t&&t.stopPropagation()}(t)):null===n&&console.warn("Unknown command:",e)),c(r,t)}function v(t){var e=y(this),n=t.data,r=t.inputType,o=t.key;"keyup"===t.type?(e[t.altKey?"push":"pull"]("Alt"),e[t.ctrlKey?"push":"pull"]("Control"),e[t.metaKey?"push":"pull"]("Meta"),e[t.shiftKey?"push":"pull"]("Shift"),o&&e.pull(o)):"deleteContentBackward"===r?e.pull("Backspace"):"deleteContentForward"===r?e.pull("Delete"):"deleteWordBackward"===r?e.pull("Control").pull("Backspace"):"deleteWordForward"===r?e.pull("Control").pull("Delete"):"insertLineBreak"===r?e.pull("Enter"):"insertText"===r&&n&&e.pull(n)}var w={attach:function(){var t,n,r=this,o=r.constructor._,l=new u(r);return r.commands=f(r.commands=l.commands,r.state.commands||{}),r.keys=f(r.keys=l.keys,r.state.keys||{}),!e(o.command)&&(o.command=function(t,e){return this.commands[t]=e,this}),!e(o.k)&&(o.k=function(t){var e=y(this).toArray();return!1===t?e:e.join(t||"-")}),!e(o.key)&&(o.key=function(t,e){return this.keys[t]=e,this}),r.on("blur",h),r.on("focus",m),r.on("key.down",k),r.on("key.up",v),r.on("put.down",k),r.on("put.up",v),t=r,n=l,d.set(t,n),r},detach:function(){var t,e=this;return y(e).pull(),e.off("blur",h),e.off("focus",m),e.off("key.down",k),e.off("key.up",v),e.off("put.down",k),e.off("put.up",v),t=e,d.delete(t),e},name:"TextEditor.Key"};return w}));